<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vibe Coding å…¥é—¨ï¼ˆ8 è®²ï¼‰</title>
  <style>
    :root{--bg:#f5f7fb;--card:#ffffff;--primary:#4f46e5;--secondary:#06b6d4;--text:#1f2937;}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;background:var(--bg);color:var(--text);}
    header{background:linear-gradient(120deg,var(--primary),var(--secondary));color:#fff;padding:1.2rem;text-align:center;}
    .container{max-width:980px;margin:auto;padding:1rem;}
    .lesson{background:var(--card);border-radius:12px;padding:1rem;margin-bottom:1rem;box-shadow:0 8px 20px rgba(0,0,0,.06)}
    h2{color:var(--primary)}
    button{background:var(--primary);color:#fff;border:none;border-radius:8px;padding:.5rem .8rem;cursor:pointer}
    button.secondary{background:var(--secondary)}
    .quiz{margin-top:.5rem;padding:.5rem;border-left:4px solid var(--secondary)}
    .ref{font-size:.9rem;color:#374151;margin-top:.5rem}
    
    /* ===== ä¼˜åŒ–çš„èŠå¤©æ¡†æ ·å¼ï¼ˆä¿æŒåŸæœ‰é£æ ¼ï¼‰ ===== */
    #chat {
      position: fixed;
      right: 1rem;
      bottom: 1rem;
      width: 380px; /* ç¨å¾®è°ƒå°ä¸€ç‚¹ */
      max-width: 90vw;
      height: 450px; /* é«˜åº¦å‡å° */
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.2);
      display: flex;
      flex-direction: column;
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    /* æœ€å°åŒ–çŠ¶æ€ */
    #chat.minimized {
      height: 45px; /* åªæ˜¾ç¤ºæ ‡é¢˜æ  */
      overflow: hidden;
    }
    
    /* æ ‡é¢˜æ  - å¯ç‚¹å‡»æœ€å°åŒ– */
    #chat header {
      background: var(--primary);
      padding: .6rem;
      font-size: .9rem;
      color: #fff;
      border-radius: 14px 14px 0 0;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      user-select: none;
    }
    
    .chat-title {
      flex: 1;
    }
    
    .chat-controls {
      display: flex;
      gap: 0.5rem;
    }
    
    .chat-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      cursor: pointer;
    }
    
    .chat-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    /* æ¶ˆæ¯åŒºåŸŸ - ä¼˜åŒ–å¸ƒå±€ */
    #messages {
      flex: 1;
      overflow: auto;
      padding: .8rem;
      font-size: .9rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    /* æ¶ˆæ¯æ°”æ³¡ */
    .msg {
      max-width: 90%;
      padding: .6rem .8rem;
      border-radius: 12px;
      line-height: 1.4;
      word-break: break-word;
    }
    
    .msg.ai {
      background: #eef2ff;
      align-self: flex-start;
      border-radius: 0 12px 12px 12px;
    }
    
    .msg.user {
      background: var(--primary);
      color: white;
      align-self: flex-end;
      border-radius: 12px 12px 0 12px;
    }
    
    /* è¾“å…¥åŒºåŸŸ */
    #inputArea {
      display: flex;
      border-top: 1px solid #e5e7eb;
    }
    
    #userInput {
      flex: 1;
      border: none;
      padding: .7rem;
      font-size: .9rem;
      outline: none;
      border-radius: 0 0 0 14px;
    }
    
    #sendBtn {
      border-radius: 0 0 14px 0;
      padding: 0 1.2rem;
    }
    
    /* ä¿æŒåŸæœ‰çš„è¯­éŸ³æŒ‰é’®æ ·å¼ */
    .speaker {
      cursor: pointer;
      margin-left: .3rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 22px;
      height: 22px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 50%;
      font-size: 0.7rem;
      color: var(--primary);
    }
    
    .speaker:hover {
      background: rgba(255, 255, 255, 0.9);
    }
    
    /* åŠ è½½åŠ¨ç”»ä¿æŒåŸæœ‰ */
    .loader {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 3px solid #c7d2fe;
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 0.5rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 768px) {
      #chat {
        width: calc(100vw - 2rem);
        right: 1rem;
        left: 1rem;
        max-width: calc(100vw - 2rem);
        height: 400px; /* ç§»åŠ¨ç«¯æ›´å°é«˜åº¦ */
      }
      
      #chat.minimized {
        height: 40px;
        width: 120px;
        right: 1rem;
        left: auto;
      }
    }
    
    /* é˜²æ­¢èŠå¤©æ¡†é®æŒ¡é¡µé¢å†…å®¹æç¤º */
    body::after {
      content: "ğŸ’¡ å³ä¸‹è§’å¯è°ƒæ•´AIåŠ©æ‰‹çª—å£";
      position: fixed;
      bottom: 480px;
      right: 1rem;
      background: var(--secondary);
      color: white;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      font-size: 0.7rem;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }
    
    body:hover::after {
      opacity: 0.9;
    }
  </style>
</head>
<body>
<header>
  <h1>Vibe Coding å…¥é—¨é€Ÿæˆ Â· 8 è®²</h1>
  <p>ä»ç›´è§‰ç¼–ç¨‹åˆ°ç†æ€§è¡¥å……ï¼ˆSDD æ„è¯†ï¼‰</p>
  <p>å¤©æ´¥è´¢ç»å¤§å­¦ç»Ÿè®¡å­¦é™¢æ•™æˆ é¾šå‡¤ä¹¾</p>
</header>
<div class="container" id="lessons"></div>

<!-- ä¼˜åŒ–åçš„èŠå¤©æ¡† -->
<div id="chat">
  <header onclick="toggleMinimize()">
    <span class="chat-title">AI åŠ©æ‰‹ï¼ˆDeepSeekï¼‰</span>
    <div class="chat-controls">
      <button class="chat-btn" onclick="toggleMinimize(event)">âˆ’</button>
      <button class="chat-btn" onclick="clearChat()">ğŸ—‘ï¸</button>
    </div>
  </header>
  <div id="messages">
    <!-- é»˜è®¤æ¬¢è¿æ¶ˆæ¯ -->
    <div class="msg ai">
      æˆ‘æ˜¯ Vibe Coding åŸ¹è®­åŠ©æ•™ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥é—®æˆ‘ï¼<span class='speaker' onclick='toggleTTS(this, "æˆ‘æ˜¯ Vibe Coding åŸ¹è®­åŠ©æ•™ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥é—®æˆ‘ï¼")'>ğŸ”Š</span>
    </div>
  </div>
  <div id="inputArea">
    <input id="userInput" placeholder="éšæ—¶æé—®â€¦" />
    <button id="sendBtn">å‘é€</button>
  </div>
</div>

<script>
// ===== ä¿æŒåŸæœ‰çš„è¯¾ç¨‹æ•°æ® =====
const lessonsData = [
  {title:"ç¬¬1è®²ï½œä»€ä¹ˆæ˜¯ Vibe Coding", content:"Vibe Coding æŒ‡çš„æ˜¯åœ¨å‡ ä¹ä¸åšä¸¥æ ¼è®¾è®¡çš„å‰æä¸‹ï¼Œä¾é ç›´è§‰ã€æ„Ÿè§‰å’Œå³æ—¶åé¦ˆæ¥ç¼–å†™ä»£ç ã€‚å®ƒå¼ºè°ƒâ€˜å…ˆè·‘èµ·æ¥â€™ï¼Œéå¸¸é€‚åˆåŸå‹é˜¶æ®µæˆ–å­¦ä¹ åˆæœŸã€‚", quiz:{q:"Vibe Coding çš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼Ÿ",options:["ä¸¥æ ¼è§„æ ¼","å…ˆè®¾è®¡åç¼–ç ","ç›´è§‰é©±åŠ¨å¿«é€Ÿå®ç°","å½¢å¼åŒ–éªŒè¯"],a:2}, ref:"ä¸­æ–‡ï¼šhttps://www.zhihu.com/question/442845233ï¼ŒEnglish: https://pragprog.com/titles/tpp20/the-pragmatic-programmer-20th-anniversary-edition/"},
  {title:"ç¬¬2è®²ï½œVibe Coding ä¸ºä½•æµè¡Œ", content:"éšç€å¤§æ¨¡å‹å‡ºç°ï¼Œå¼€å‘è€…å¯ä»¥ç”¨è‡ªç„¶è¯­è¨€å¿«é€Ÿç”Ÿæˆä»£ç ï¼Œä½¿å¾—å‡­æ„Ÿè§‰è¯•é”™çš„æˆæœ¬å¤§å¹…ä¸‹é™ï¼ŒVibe Coding å› æ­¤æµè¡Œã€‚", quiz:{q:"ä¿ƒä½¿ Vibe Coding æµè¡Œçš„å…³é”®æŠ€æœ¯ï¼Ÿ",options:["åŒºå—é“¾","å¤§è¯­è¨€æ¨¡å‹","ç¼–è¯‘å™¨","æ“ä½œç³»ç»Ÿ"],a:1}, ref:"ä¸­æ–‡ï¼šhttps://www.infoq.cn/article/xyzï¼ŒEnglish: https://arxiv.org/abs/2301.11102"},
  {title:"ç¬¬3è®²ï½œé€‚åˆå“ªäº›äºº", content:"æ–°æ‰‹ã€ç‹¬ç«‹å¼€å‘è€…ã€åŸå‹è®¾è®¡è€…æœ€é€‚åˆ Vibe Codingã€‚å®ƒé™ä½å¿ƒç†é—¨æ§›ï¼Œä½†ä¸ç­‰äºå¯ä»¥å¿½è§†åŸºç¡€ã€‚", quiz:{q:"è°æœ€é€‚åˆ Vibe Codingï¼Ÿ",options:["èŠ¯ç‰‡è®¾è®¡","åˆå­¦è€…","æ•°æ®åº“ç®¡ç†å‘˜","è¿ç»´å·¥ç¨‹å¸ˆ"],a:1}, ref:"ä¸­æ–‡ï¼šhttps://juejin.cn/post/xyzï¼ŒEnglish: https://www.freecodecamp.org/news/"},
  {title:"ç¬¬4è®²ï½œVibe Coding çš„é£é™©", content:"æ²¡æœ‰ç»“æ„çº¦æŸå®¹æ˜“å¯¼è‡´ä»£ç æ··ä¹±ã€éš¾ç»´æŠ¤ï¼Œå› æ­¤å¿…é¡»æ„è¯†åˆ°å…¶è¾¹ç•Œã€‚", quiz:{q:"ä¸»è¦é£é™©æ˜¯ï¼Ÿ",options:["å¤ªæ…¢","ä»£ç æ··ä¹±","æ— æ³•è¿è¡Œ","å¤ªå®‰å…¨"],a:1}, ref:"ä¸­æ–‡ï¼šhttps://www.zhihu.com/question/xyzï¼ŒEnglish: https://www.geekbang.org/article/xyz"},
  {title:"ç¬¬5è®²ï½œSDD çš„è¡¥å……æ„ä¹‰", content:"SDDï¼ˆè§„æ ¼é©±åŠ¨å¼€å‘ï¼‰ä¸º Vibe Coding æä¾›ç†æ€§æŠ¤æ ï¼Œåœ¨å…³é”®æ¨¡å—å¼•å…¥è§„æ ¼ã€‚", quiz:{q:"SDD çš„ä½œç”¨ï¼Ÿ",options:["æ›¿ä»£ Vibe","æä¾›çº¦æŸ","å¢åŠ æˆæœ¬","é™åˆ¶åˆ›é€ "],a:1}, ref:"ä¸­æ–‡ï¼šhttps://techblog.aliyun.com/xyzï¼ŒEnglish: https://en.wikipedia.org/wiki/Software_Development_Process"},
  {title:"ç¬¬6è®²ï½œå¦‚ä½•ç»“åˆä½¿ç”¨", content:"å…ˆç”¨ Vibe Coding å¿«é€Ÿæ¢ç´¢ï¼Œå†ç”¨ SDD å›ºåŒ–ç»“æ„ï¼Œæ˜¯ç°å®ä¸­æœ€æœ‰æ•ˆçš„æ–¹å¼ã€‚", quiz:{q:"æ¨èæµç¨‹æ˜¯ï¼Ÿ",options:["åªç”¨ Vibe","å…ˆ SDD","Vibeâ†’SDD","éšæœº"],a:2}, ref:"ä¸­æ–‡ï¼šhttps://sspai.com/post/xyzï¼ŒEnglish: https://www.smashingmagazine.com/"},
  {title:"ç¬¬7è®²ï½œAI åœ¨å…¶ä¸­çš„è§’è‰²", content:"AI ä¸åªæ˜¯ä»£ç ç”Ÿæˆå™¨ï¼Œæ›´æ˜¯éšæ—¶å¯å’¨è¯¢çš„æ­æ¡£ã€‚", quiz:{q:"AI æœ€é‡è¦çš„è§’è‰²ï¼Ÿ",options:["è£åˆ¤","æ­æ¡£","é™åˆ¶è€…","ç¼–è¯‘å™¨"],a:1}, ref:"ä¸­æ–‡ï¼šhttps://www.geekbang.org/article/xyzï¼ŒEnglish: https://www.ibm.com/cloud/learn/ai-in-software-development"},
  {title:"ç¬¬8è®²ï½œä»æ–°æ‰‹åˆ°æˆç†Ÿå¼€å‘è€…", content:"çœŸæ­£æˆç†Ÿçš„å¼€å‘è€…çŸ¥é“ä½•æ—¶å‡­æ„Ÿè§‰ï¼Œä½•æ—¶å›åˆ°è§„æ ¼ã€‚", quiz:{q:"æˆç†Ÿæ ‡å¿—æ˜¯ï¼Ÿ",options:["å†™å¾—å¿«","ä¸ç”¨è®¾è®¡","çµæ´»åˆ‡æ¢æ–¹æ³•","å®Œå…¨ä¾èµ– AI"],a:2}, ref:"ä¸­æ–‡ï¼šhttps://zhuanlan.zhihu.com/p/xyzï¼ŒEnglish: https://pragprog.com/titles/tpp20/the-pragmatic-programmer-20th-anniversary-edition/"}
];

// ===== ä¿æŒåŸæœ‰çš„è¯¾ç¨‹æ¸²æŸ“ =====
const lessonsDiv = document.getElementById('lessons');
lessonsData.forEach((l,i)=>{
  const d = document.createElement('div'); d.className='lesson';
  d.innerHTML = `<h2>${l.title}</h2><p>${l.content}</p>
    <div class='quiz'><b>å°æµ‹ï¼š</b>${l.quiz.q}<br>${l.quiz.options.map((o,idx)=>`<label><input type='radio' name='q${i}' value='${idx}'>${o}</label>`).join('<br>')}<br><button onclick='check(${i})'>æäº¤</button></div>
    <div class='ref'>å‚è€ƒï¼š${l.ref}</div>`;
  lessonsDiv.appendChild(d);
});

function check(i){
  const sel = document.querySelector(`input[name=q${i}]:checked`);
  if(!sel || Number(sel.value)!==lessonsData[i].quiz.a){alert('æœªå®Œå…¨æ­£ç¡®ï¼Œè¯·é‡è¯•');}
  else alert('æ­£ç¡®ï¼');
}

// ===== èŠå¤©åŠŸèƒ½ä¼˜åŒ–ï¼ˆä¿æŒåŸæœ‰åŠŸèƒ½ï¼‰ =====
let speaking = false;
let utter;
let isMinimized = false;

function cleanText(t) {
  return t.replace(/[â€€-â¿¿\p{P}\p{S}]/gu,'');
}

// åˆ‡æ¢æœ€å°åŒ–/æœ€å¤§åŒ–
function toggleMinimize(e) {
  if (e) e.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡
  
  const chat = document.getElementById('chat');
  isMinimized = !isMinimized;
  
  if (isMinimized) {
    chat.classList.add('minimized');
  } else {
    chat.classList.remove('minimized');
    // å±•å¼€æ—¶èšç„¦è¾“å…¥æ¡†
    setTimeout(() => {
      document.getElementById('userInput').focus();
    }, 100);
  }
}

// æ¸…ç©ºèŠå¤©è®°å½•
function clearChat() {
  const messages = document.getElementById('messages');
  messages.innerHTML = '<div class="msg ai">æˆ‘æ˜¯ Vibe Coding åŸ¹è®­åŠ©æ•™ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥é—®æˆ‘ï¼<span class="speaker" onclick="toggleTTS(this, \'æˆ‘æ˜¯ Vibe Coding åŸ¹è®­åŠ©æ•™ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥é—®æˆ‘ï¼\')">ğŸ”Š</span></div>';
}

// å‘é€æ¶ˆæ¯ï¼ˆä¿æŒåŸæœ‰é€»è¾‘ï¼‰
async function sendMsg() {
  const inp = document.getElementById('userInput');
  if (!inp.value.trim()) return;
  
  const msg = inp.value;
  inp.value = '';
  
  const mdiv = document.getElementById('messages');
  
  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  const userMsg = document.createElement('div');
  userMsg.className = 'msg user';
  userMsg.textContent = msg;
  mdiv.appendChild(userMsg);
  
  // ç¡®ä¿èŠå¤©æ¡†å±•å¼€
  if (isMinimized) {
    toggleMinimize();
  }
  
  // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  const loader = document.createElement('div');
  loader.className = 'msg ai';
  loader.innerHTML = '<span class="loader"></span> æ€è€ƒä¸­...';
  mdiv.appendChild(loader);
  mdiv.scrollTop = mdiv.scrollHeight;
  
  try {
    const res = await fetch('/.netlify/functions/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: msg })
    });
    
    const data = await res.json();
    
    // ç§»é™¤åŠ è½½çŠ¶æ€ï¼Œæ·»åŠ AIå›å¤
    loader.remove();
    
    const aiMsg = document.createElement('div');
    aiMsg.className = 'msg ai';
    aiMsg.innerHTML = `${data.reply}<span class='speaker' onclick='toggleTTS(this, ${JSON.stringify(data.reply)})'>ğŸ”Š</span>`;
    mdiv.appendChild(aiMsg);
    
  } catch (e) {
    loader.innerHTML = 'AI æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•';
  }
  
  mdiv.scrollTop = mdiv.scrollHeight;
}

// äº‹ä»¶ç›‘å¬å™¨
document.getElementById('sendBtn').addEventListener('click', sendMsg);

// å›è½¦å‘é€
document.getElementById('userInput').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    sendMsg();
  }
});

// è¯­éŸ³åŠŸèƒ½ï¼ˆä¿æŒåŸæœ‰ï¼‰
function toggleTTS(el, text) {
  if (speaking) {
    speechSynthesis.cancel();
    speaking = false;
    return;
  }
  
  utter = new SpeechSynthesisUtterance(cleanText(text));
  utter.lang = 'zh-CN';
  utter.rate = 1;
  utter.pitch = 1;
  speaking = true;
  
  utter.onend = () => {
    speaking = false;
  };
  
  speechSynthesis.speak(utter);
}

// é¡µé¢åŠ è½½åè‡ªåŠ¨èšç„¦è¾“å…¥æ¡†ï¼ˆå¦‚æœèŠå¤©æ¡†å¯è§ï¼‰
window.addEventListener('load', function() {
  // å»¶è¿Ÿä¸€ä¼šå„¿ï¼Œè®©é¡µé¢å®Œå…¨åŠ è½½
  setTimeout(() => {
    if (!isMinimized) {
      document.getElementById('userInput').focus();
    }
  }, 500);
});
</script>
</body>
</html>